{% extends "zerver/portico.html" %}

{% block portico_content %}

<div class="app find-account-page flex full-page">
    <div class="inline-block new-style">
        <div class="lead">
            <h1 class="get-started">{{ _("Find your Zulip accounts") }}â€¦</h1>
        </div>

        <div class="app-main find-account-page-container white-box">
            {% if emails %}
            <div id="results">
                <p>
                    Emails sent! You will only receive emails at addresses associated
                    with Zulip organizations. The addresses entered on the previous page
                    are listed below:
                </p>

                <ul>
                    {% for email in emails %}
                    <li>{{ email }}</li>
                    {% endfor %}
                </ul>

                {% include 'zerver/dev_env_email_access_details.html' %}

            </div>
            {% else %}
            <div class="find-account-form">
                <p>
                    We will send you an email with the sign-in information for
                    any Zulip organization(s) associated with the addresses you enter below.
                </p>
                <form class="form-inline" id="find_account" name="email_form"
                  action="{{ current_url() }}" method="post">
                    {{ csrf_input }}
                    <div class="input-box moving-label horizontal">
                        <div class="inline-block relative">
                            <input type="text" autofocus id="emails" name="emails" required />
                            <label for="emails">{{ _('Email addresses') }}</label>
                        </div>
                        <button type="submit" id="submit_button">{{ _('Find accounts') }}</button>
                    </div>
                    <div><i>{{ form.emails.help_text }}</i></div>
                </form>
                <div id="errors"></div>
                {% if form.emails.errors %}
                    {% for error in form.emails.errors %}
                    <div class="alert alert-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
                <div class="alert alert-error invalid-error-text" id="invalid_emails_text">Enter a valid email address</div>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
                <script id="button_logic">
                    $(document).ready(function(){
                        $("#emails").on("change", function(){
                            validateEmails(document.getElementById("emails").value);
                        });
                    });

                    function validateEmails(val){
                        if (val && validate(val.split(","))) {
                            document.getElementById("submit_button").disabled = false;
                            document.getElementById("submit_button").className = "";
                            document.getElementById("invalid_emails_text").className = "alert alert-error invalid-error-text";
                        } else {
                            document.getElementById("submit_button").disabled = true;
                            document.getElementById("submit_button").className = "disabled-submit-button";
                            document.getElementById("invalid_emails_text").className = "alert alert-error";
                        }
                    }

                    function validate(emailList){
                        var re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                        var valid = true;

                        emailList.forEach(function(element) {
                            if (!re.test(element.trim())) {
                                valid = false;
                            }
                        });

                        return valid;
                    }
                </script>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
